---
title: "Analysis"
author: "Derek Brickley"
date: "1/26/2022"
output: html_document
---


<style type="text/css">
  body{
  font-size: 16pt;
}
</style>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning=FALSE)
```

```{r, warning=FALSE}
library(MASS)
library(gridExtra)  
library(mnormt) 
library(lme4) 
library(knitr) 
library(kableExtra)
library(tidyverse)
library(GGally)
library(mice)
library(nlme)
library(boot)
library(HLMdiag)
library(pander)
library(skimr)
library(corrplot)
```

```{r}
sports <- read.csv("Full_Data.csv")
```

```{r, results = "hide"}
sports %>% count(School)
sports %>% count(Start.Year)
```


```{r, results = 'hide'}
select <- dplyr::select
keydata <- sports %>% 
  dplyr::select(program.id,
      Pct, Start.Year, Sport, School, State, Multi.Year.APR)
# Create Level2 data set by picking off one observation 
# per subject, which would be easier if every subject 
# had a diary entry labeled '1' - should be 37 rows 
# and 6 columns (one per L2 variable)
school.lev2 <-  keydata %>%
  group_by(School) %>%
  filter(row_number() == 1) %>%
  select(School, Start.Year)

year.lev2 <-  keydata %>%
  group_by((Start.Year)) %>%
  filter(row_number() == 1) %>%
  select(School, Start.Year)
```

```{r}
meanbyschool <- sports %>% group_by(School) %>%
  summarise(meanbyschool = mean(Multi.Year.APR, na.rm = TRUE))
school.lev2 <- school.lev2 %>%
  left_join(meanbyschool, by = "School")

meanbyyear <- sports %>% group_by(Start.Year) %>%
  summarise(meanbyyear = mean(Multi.Year.APR, na.rm = TRUE))
year.lev2 <- year.lev2 %>%
  left_join(meanbyyear, by = "Start.Year")
```

```{r, results = 'hide'}
sports %>% count(Sport)
```

```{r, results = 'hide'}
theme.1 <- theme(axis.title.x = element_text(size = 14),
  axis.title.y = element_text(size = 14),
  plot.title=element_text(hjust=.9,face="italic",size=12))
## Histogram of negative affect frequencies
apr.all <- ggplot(data=sports,aes(x=Multi.Year.APR)) + 
  geom_histogram(binwidth = 20, fill = "white",color = "black") + 
  theme.1 + xlim(400,1000) +
  xlab("Multi Year APR Score") + ylab("Frequency") + labs(title="(a)") 

apr.mean <- ggplot(data=school.lev2,aes(x=meanbyschool)) + 
  geom_histogram(binwidth = 20, fill = "white", 
                 color = "black") + 
  theme.1 + xlim(800,1000) +
  xlab("Mean APR Score by School") + ylab("Frequency") + labs(title="(b)") 

year.apr.mean <- ggplot(data=year.lev2,aes(x=meanbyyear)) + 
  geom_histogram(binwidth = 20, fill = "white", 
                 color = "black") + 
  theme.1 + xlim(800,1000) +
  xlab("Mean APR Score by Year") + ylab("Frequency") + labs(title="(c)") 
mli.hist1 <- grid.arrange(apr.all,apr.mean,year.apr.mean, ncol=1)
```

```{r}
ggplot(sports,aes(x=Start.Year,y=Multi.Year.APR)) +
  geom_smooth(method= "lm", color = "black") + 
  labs(x="Academic Year",y="Multi-Year APR Score") +
  theme.1
```

```{r}
select_sports <- sports %>% select(Pct, centeredAPR, pcip09, ugds, ugds_men, ugds_white, costt4_a, age_entry) %>%
  rename('Win Percentage' = Pct, "APR" = centeredAPR, "Percent Communication" = pcip09, "Students Enrolled" = ugds, "Percent Male" = ugds_men, "Percent White" = ugds_white, "Average Cost" = costt4_a, "Average age at entry" = age_entry)
Corr <- cor(select_if(select_sports, is.numeric), use="complete.obs")
corrplot(Corr, type = "full", order = "hclust", 
         tl.col = "black", tl.srt = 45)
```

```{r}
LMRegion <- ggplot(sports, aes(x = centeredAPR, y = Pct, color = as.factor(Region))) +
  geom_smooth(method='lm') + 
  theme.1 + xlim(-200,25)

LMRegion
```

```{r}
set.seed(1313)
randschool = as.vector(sample(sports$School,size=25))
schoolsrd <- sports %>%
  filter(School %in% randschool) %>%
  group_by(School, Start.Year) %>%
  summarize(meanAPR = mean(Multi.Year.APR, na.rm = TRUE))
  
ggplot(schoolsrd, aes(x=Start.Year, y=meanAPR)) + 
  facet_wrap(~School,ncol=5) + 
  geom_point() + 
  geom_smooth(method="lm") + 
  theme.1 +
  theme(strip.text.x=element_blank()) + 
  labs(x="Academic Year",y="Average Multi-Year APR Score")
```

```{r}
set.seed(1313)
randsport = as.vector(sample(sports$School,size=4))

sportsrd <- sports %>%
  filter(School %in% randsport)
  
ggplot(sportsrd, aes(x=Start.Year, y=Multi.Year.APR)) + 
  facet_wrap(~program.id,ncol=4) + 
  geom_point() + 
  geom_smooth(method="lm") + 
  theme.1 +
  theme(strip.text.x=element_blank()) + 
  labs(x="Academic Year",y="Multi-Year APR Score")
```

$Y_i,_j,_k = \alpha_0 +\beta_1APR_i,_j,_k + \epsilon_i,_j,_k$

```{r}
OLSpartial = lm(Pct ~ centeredAPR, data = sports)

coef(summary(OLSpartial))
```

$Y_i,_j,_k = \alpha_0 +\beta_1APR_i,_j,_k + \beta_2Enrollment_i + \beta_3PercentCommunication_i + \beta_4NewEngland_i + \beta_5MidEast_i + \beta_6GreatLakes_i + \beta_7Plains_i + \beta_8SouthEast_i + \beta_9SouthWest_i + \beta_10RockyMountains_i + \beta_11FarWest_i + \beta_12Outlying_i + \epsilon_i,_j,_k$

```{r}
OLSfull = lm(Pct ~ centeredAPR + ugds + pcip09 + factor(Region), data = sports)

coef(summary(OLSfull))
```

$Y_i,_j,_k = \alpha_0 +\beta_1APR_i,_j,_k + s_i + p_i,_j + \epsilon_i,_j,_k$

```{r}
partialintercept = lmer(Pct ~ centeredAPR + (1|School) + (1|program.id), REML=T, data=sports)

VCrandom <- VarCorr(partialintercept)
print(VCrandom, comp = c("Variance", "Std.Dev."))
cat(" Number of Level Two groups = ",
    summary(partialintercept)$ngrps[1], "\n", 
    "Number of Level Three groups = ",
    summary(partialintercept)$ngrps[2])
coef(summary(partialintercept))
```

$Y_i,_j,_k = \alpha_0 + \beta_1APR_i,_j,_k  + \beta_2Enrollment_i + \beta_3PercentCommunication_i + \beta_4NewEngland_i + \beta_5MidEast_i + \beta_6GreatLakes_i + \beta_7Plains_i + \beta_8SouthEast_i + \beta_9SouthWest_i + \beta_10RockyMountains_i + \beta_11FarWest_i + \beta_12Outlying_i + s_i + p_i,_j + \epsilon_i,_j,_k$

```{r}
fullintercept = lmer(Pct ~ centeredAPR + ugds + pcip09 + factor(Region) + (1|School) + (1|program.id), REML=T, data=sports)

VCrandom <- VarCorr(fullintercept)
print(VCrandom, comp = c("Variance", "Std.Dev."))
cat(" Number of Level Two groups = ",
    summary(fullintercept)$ngrps[1], "\n", 
    "Number of Level Three groups = ",
    summary(fullintercept)$ngrps[2])
coef(summary(fullintercept))
```

$Y_i,_j,_k = \alpha_0 +\beta_1APR_i,_j,_k + s_i + m_iAPR + p_i,_j + \epsilon_i,_j,_k$

```{r}
partialschoolslope = lmer(Pct ~ centeredAPR + (centeredAPR|School) + (1|program.id), REML=T, data=sports)

VCrandom <- VarCorr(partialschoolslope)
print(VCrandom, comp = c("Variance", "Std.Dev."))
cat(" Number of Level Two groups = ",
    summary(partialschoolslope)$ngrps[1], "\n", 
    "Number of Level Three groups = ",
    summary(partialschoolslope)$ngrps[2])
coef(summary(partialschoolslope))
```

$Y_i,_j,_k = \alpha_0 +\beta_1APR_i,_j,_k + \beta_2Enrollment_i + \beta_3PercentCommunication_i + \beta_4NewEngland_i + \beta_5MidEast_i + \beta_6GreatLakes_i + \beta_7Plains_i + \beta_8SouthEast_i + \beta_9SouthWest_i + \beta_10RockyMountains_i + \beta_11FarWest_i + \beta_12Outlying_i + s_i + m_iAPR + p_i,_j + \epsilon_i,_j,_k$

```{r}
fullschoolslope = lmer(Pct ~ centeredAPR + ugds + pcip09 + factor(Region) + (centeredAPR|School) + (1|program.id), REML=T, data=sports)

VCrandom <- VarCorr(fullschoolslope)
print(VCrandom, comp = c("Variance", "Std.Dev."))
cat(" Number of Level Two groups = ",
    summary(fullschoolslope)$ngrps[1], "\n", 
    "Number of Level Three groups = ",
    summary(fullschoolslope)$ngrps[2])
coef(summary(fullschoolslope))
```

$Y_i,_j,_k = \alpha_0 +\beta_1APR_i,_j,_k + s_i + p_i,_j + m_iAPR + \epsilon_i,_j,_k$

```{r}
partialprogramslope = lmer(Pct ~ centeredAPR + (1|School) + (centeredAPR|program.id), REML=T, data=sports)

VCrandom <- VarCorr(partialprogramslope)
print(VCrandom, comp = c("Variance", "Std.Dev."))
cat(" Number of Level Two groups = ",
    summary(partialprogramslope)$ngrps[1], "\n", 
    "Number of Level Three groups = ",
    summary(partialprogramslope)$ngrps[2])
coef(summary(partialprogramslope))
```

$Y_i,_j,_k = \alpha_0 +\beta_1APR_i,_j,_k + \beta_2Enrollment_i + \beta_3PercentCommunication_i + \beta_4NewEngland_i + \beta_5MidEast_i + \beta_6GreatLakes_i + \beta_7Plains_i + \beta_8SouthEast_i + \beta_9SouthWest_i + \beta_10RockyMountains_i + \beta_11FarWest_i + \beta_12Outlying_i + s_i + p_i,_j + m_iAPR + \epsilon_i,_j,_k$

```{r}
fullprogramslope = lmer(Pct ~ centeredAPR + ugds + pcip09 + factor(Region) + (1|School) + (centeredAPR|program.id), REML=T, data=sports)

VCrandom <- VarCorr(fullprogramslope)
print(VCrandom, comp = c("Variance", "Std.Dev."))
cat(" Number of Level Two groups = ",
    summary(fullprogramslope)$ngrps[1], "\n", 
    "Number of Level Three groups = ",
    summary(fullprogramslope)$ngrps[2])
coef(summary(fullprogramslope))
```

# The Effect of Academic Performance on Athletic Success in Collegiate Athletic Programs

## Introduction

  Across the country, there are more than 500,000 college athletes competing for 1,100 different schools in the National Collegiate Athletics Association (NCAA). All of the players are also students, attending their institution to play their respective sport and succeed athletically and to achieve their academic goals and graduate with a college degree. Coaches scout high school athletes nationwide looking for the best talent to bring into their individual programs, but many coaches ignore the potential effect of having athletes that are high quality students. Why should the NCAA and college programs emphasize the importance of academics? With college sports being over a $18 billion business, it would seem that the academics of the athletes is the least of the NCAA’s concern. However, in addition to better preparing the athletes for life after their athletic career, academics may play a role in the success of athletic programs. 
  
  I argue that increased academic performance of student-athletes increases athletic success of their respective sport's program. By using a mixed effect model, we can look at how success in the classroom is related to how a team performs. In my analysis I will look at programs' Academic Progress Rate (APR), measuring the eligibility and retention of athletes, and win percentage from nine different sports from 2010 to 2018.

## Data

  The data in this research merged two datasets from the NCAA and data from the College Scorecard.  The resulting dataframe is panel data that contains data from 394 schools and nine different sports over eight years.  This study focuses only on team sports and the relationship between team academic performance and that team's athletic success.  Specifically this data was filtered to focus on nine team sports: Men's Soccer, Women's Soccer, Baseball, Softball, Men's Basketball, Women's Basketball, Football, Men's Ice Hockey, and Women's Ice Hockey.  In total there are 17,700 observations with 21 variables.  
  
```{r table1,fig.align="center",out.width="60%",echo=FALSE, warning = FALSE}
table1 <- sports %>% select(School, "School ID" = School_ID, Region, "Percent Communication Major" = pcip09, "Total Enrollment" = ugds, "Percent Male" = ugds_men, "Percent White" = ugds_white, "Average Cost of Attendance" = costt4_a, "Average Age at Enrollment" = age_entry, Sport, "Program ID" = program.id, "Win Percentage" = Pct, "Multi-Year APR" = Multi.Year.APR, "Year" = Start.Year)
preview <- head(table1, 5)
kable(preview, booktabs=T,
      caption="Table 1: A snapshot of selected variables from the first five observations in the academics and athletics combined dataset.") %>%
    kable_styling(latex_options = "scale_down", font_size = 16) 
```
  
  The first dataset used is the online NCAA Academic Progress Rate Database. From this the variables of interest are the schools, the state each school is in, the various sports, the individual years, and each specific program's APR score.  Each athlete on the team can receive at most 2 points, one for remaining eligible over the semester and another for staying at the institution. So, each athlete can have anywhere between zero and two points for a given semester. The APR score for each Division I team is calculated by adding all points earned by the team and dividing that total by the maximum possible number of points that could have been earned. This percentage is then multiplied by 1,000 to return the team’s APR score. Thus, an APR of 950 means that the student-athletes in the cohort earned 95 percent of the eligibility and retention points that they could have earned.  It is important to note that APR in this dataset represents a four-year rolling average of APR scores.
  
```{r figure1,fig.align="center",out.width="60%",fig.cap= 'Figure 1: Boxplots of Multi-Year APR scores for each sport. Plot (a) is based on all 17,700 observations from all 2,168 programs over all years, while plot (b) uses only one observation per program', echo=FALSE, warning=FALSE}
box.sport <- ggplot(data=sports,aes(factor(Sport),Multi.Year.APR)) +
  geom_boxplot() + 
  theme.1 + coord_flip() + ylab("Multi-Year APR") + 
  xlab("") + labs(title="(a)")

select_year <- sports %>% group_by(program.id, Sport) %>%
  summarize(MeanAPR = mean(Multi.Year.APR))

box.sport2 <- ggplot(data=select_year,aes(factor(Sport),MeanAPR)) +
  geom_boxplot() + 
  theme.1 + coord_flip() + ylab("Mean APR") + 
  xlab("") + labs(title="(b)")

grid.arrange(box.sport, box.sport2, ncol = 1)
```
  
  The second NCAA dataset is a combination of datasets of the nine different team sports and their athletic performance in each year from 2010-2018.  The important variables from this database are the team name, the team's win percentage, and the year of observation.  With each dataset, it was necessary to create a new variable for the sport to keep track of which program is being observed when all datasets are merged together.  Some datasets did not have a column for ties, and as such it was necessary to create an empty column for ties that allowed for the rows in all athletic datasets to be binded together.  In some cases, the individual sports reported win percentage differently than others.  Multiple sports reported win percentage as a percentage with range from 0 to 100, while other sports reported it as a decimal 0.00 to 1.00.  For uniformity and ease of interpretation, all percentages were changed to a scale of 0 to 100.  
  
  The final data accessed is the College Scorecard data.  This database provides information about each specific institution not specific to athletics.  Each observation has the school's ID number and the name of the school.  For each school in each year the variables that were considered for their relevance are the geographic region of the school, the percent of the student body majoring in communication, the percentage of degrees awarded in Communication, Journalism, And Related Programs, the total enrollment, the percent of the student body that is white, the percent of the student body that is male, the average cost of attendance in each year, and the age at which students enroll at the institution.  
  
```{r table2, echo=FALSE, warning=FALSE}
summarydata <- sports %>% select(School, "School ID" = School_ID, Region, "Percent Communication Major" = pcip09, "Total Enrollment" = ugds, "Percent Male" = ugds_men, "Percent White" = ugds_white, "Average Cost of Attendance" = costt4_a, "Average Age at Enrollment" = age_entry, Sport, "Program ID" = program.id, "Win Percentage" = Pct, "Multi-Year APR" = Multi.Year.APR, "Year" = Start.Year)

summary <- summary(sports)
kable(summary, booktabs=T,
      caption="Table 2: Summary Statistics of the combined datasets.") %>%
    kable_styling(latex_options = "scale_down", font_size = 16)
```
  
  As with any form of modeling it is important to hold constant variables that may bias results and affect their validity.  The College Scorecard data is used to include school-level variables and to determine what aspects of a school would have an effect on its sports' win percentages.  
  
  The first variable that was considered for its relevance was geographic region.  Minyong Song and Yang Zhang's Study, *Research on the Relationship between Geographical Factors, Sports and Culture*, they conclude that "The geographical environment influences the emergence and development of sports events in different ways, Climate changes will affect the conditions of sports, but also interfere with the athletes’ body mechanism and emotion, thereby affecting athletic ability."  Their findings give merit to consider geographic region as a possible influence on win percentage.  The breakdown that follows is the classification of the geographic regions:
  
- 0	U.S. Service Schools
- 1	New England (CT, ME, MA, NH, RI, VT)
- 2	Mid East (DE, DC, MD, NJ, NY, PA)
- 3	Great Lakes (IL, IN, MI, OH, WI)
- 4	Plains (IA, KS, MN, MO, NE, ND, SD)
- 5	Southeast (AL, AR, FL, GA, KY, LA, MS, NC, SC, TN, VA, WV)
- 6	Southwest (AZ, NM, OK, TX)
- 7	Rocky Mountains (CO, ID, MT, UT, WY)
- 8	Far West (AK, CA, HI, NV, OR, WA)
- 9	Outlying Areas (AS, FM, GU, MH, MP, PR, PW, VI)
    
    
One other variable that needs to be considered is the percentage of the student body majoring in communication.  This is a very specific variable, but its potential inclusion in our data stems from the phenomenon of major clustering.  Programs and schools that cluster their student athletes into an easier, or less time-intensive major may have more energy to focus on athletics.  In addition, this may allow more student-athletes to remain eligible with a smaller work-load that some majors may offer.  Different institutions have been accused of clustering into different majors, but multiple of the accusations reinforce communications as one of the common majors subject to clustering.  As such we would expect that as the percentage of the student body majoring in communication increases we would see a corresponding increase in those programs' win percentages.  Kaydee McCormick found in their research that although clustering appears to have the possibility to occur among all college students, it seems to be more prevalent within intercollegiate athletics.  As such, if we find clustering in the general student-body it is reasonable to assume that the athletic programs at that institution are subject to clustering as well.  For uniformity and ease of interpretation, all percentages were changed from a scale of 0.00 to 1.00 to a scale of 0 to 100.
  
  Three other variables of the student body are potentially relevant for this research: The percent of the student body that is white, the percent of the student body that is male, and the average age of enrollment.  Collegiate student-athletes are a sample of the general student body, and as such we assume the demographics of the student body are representative of their student-athletes.  Ethnicity, gender, and age all impact sport participation, so we must consider them as possible controls.  Again for uniformity and ease of interpretation, the percentage male and percent white were changed from a scale of 0.00 to 1.00 to a scale of 0 to 100.
  
  The final institution level variable considered is the average cost of attendance.  Studies by Battle, Ayers et al., and Gurney analyze the relationship between academics and athletics considering the extreme burden and time commitments that student-athletes have. Regardless of their concluding argument, they rely on this connection. With such extenuating circumstances and limited time commitments, athletes do not have time and are often not allowed to work full-time and only in 2007 did the NCAA enact a policy allowing student athletes to work part-time jobs during the off-season. With that said, other than financial aid many student-athletes cannot be expected to afford the large tuition fee most institutions charge, not including student loans. Controlling for financial aid in this way adds value to the model by incorporating the affordability of different institutions, particularly for student-athletes who cannot, due to time restrictions, handle full-time employment.
  
  In the merged dataset there were multiple of the included variables that needed to be modified.  The first of these was the variable for each Academic Year.  This variable was a strain that contained the two years (the start of the year and the end of the year) connected by a hyphen.  In order to model over time, it was neccesary to convert the year variable to an integer.  The year used in this research is year from the start of the academic year.  For example, the year 2010 is the 2010-2011 academic year.  It was also important to rescale APR and years for later interpretation.  From the APR score a new variable was created to demonstrate the centered APR score, or each observation's distance from the mean APR score.  The year variable also needed to be centered; a new variable is created where the first year in the data, 2010, is represented as 0 and years are measured as years since 2010.  For example, the year 2018 would be represented as 8.  There was also a need to create a unique identifier variable for each program, i.e. a specific sport team at a specific institution.  


## Methodology



## Results



## Conclusion



## References
